<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Olympus Method — Gym Log</title>

<!-- Inter font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
    :root {
        /* High-contrast performance theme */
        --bg-body: #050608;
        --bg-app: #0b0d11;
        --bg-card: #151922;
        --bg-card-soft: #10131a;

        --accent-green: #2aff80;
        --accent-green-soft: rgba(42, 255, 128, 0.12);
        --accent-blue: #60a5fa;
        --accent-red: #ef4444;

        --border-subtle: rgba(148,163,184,0.35);
        --border-strong: rgba(148,163,184,0.7);

        --text-main: #ffffff;
        --text-soft: #9ca3af;
        --text-muted: #6b7280;

        --radius-lg: 16px;
        --radius-md: 10px;
    }

    * {
        box-sizing: border-box;
    }

    body {
        margin: 0;
        padding: 16px;
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, #111827 0, #020309 55%);
        color: var(--text-main);
    }

    .app {
        max-width: 980px;
        margin: 0 auto;
        background: var(--bg-app);
        border-radius: 22px;
        padding: 18px 18px 80px; /* extra bottom for footer */
        box-shadow: 0 18px 40px rgba(0,0,0,0.8);
        border: 1px solid rgba(148,163,184,0.4);
        position: relative;
    }

    header {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-end;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 14px;
    }

    .header-left {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    h1 {
        font-size: 1.7rem;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .logo-pill {
        font-size: 0.75rem;
        padding: 3px 9px;
        border-radius: 999px;
        background: var(--accent-green);
        color: #020309;
        text-transform: uppercase;
        letter-spacing: 0.07em;
        font-weight: 700;
    }

    .tagline {
        font-size: 0.85rem;
        color: var(--text-soft);
        opacity: 0.95;
    }

    .header-right {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 4px;
    }

    .unit-label {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-soft);
    }

    .unit-toggle {
        display: inline-flex;
        background: #05070b;
        border-radius: 999px;
        padding: 3px;
        border: 1px solid var(--border-subtle);
    }

    .unit-toggle button {
        border: none;
        padding: 6px 14px;
        border-radius: 999px;
        font-size: 0.8rem;
        cursor: pointer;
        background: transparent;
        color: #e5e7eb;
    }

    .unit-toggle button.active {
        background: var(--accent-green);
        color: #020309;
        font-weight: 600;
    }

    /* Tabs */
    .tabs {
        display: flex;
        gap: 6px;
        margin-bottom: 14px;
        flex-wrap: wrap;
    }

    .tab-button {
        border-radius: 999px;
        padding: 7px 14px;
        border: 1px solid rgba(148,163,184,0.5);
        background: #05070b;
        color: #e5e7eb;
        font-size: 0.85rem;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .tab-button span.dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: rgba(148,163,184,0.6);
    }

    .tab-button.active {
        border-color: transparent;
        background: var(--accent-green);
        color: #020309;
        font-weight: 600;
        box-shadow: 0 8px 18px rgba(42,255,128,0.35);
    }

    .tab-button.active span.dot {
        background: #020309;
    }

    .tab-panel {
        display: none;
        margin-top: 4px;
    }

    .tab-panel.active {
        display: block;
    }

    .grid {
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
        gap: 18px;
    }

    @media (max-width: 780px) {
        .grid {
            grid-template-columns: minmax(0, 1fr);
        }
    }

    .card {
        background: radial-gradient(circle at top left, #111827 0, var(--bg-card) 55%);
        border-radius: var(--radius-lg);
        padding: 18px 16px 18px;
        border: 1px solid var(--border-subtle);
    }

    .card h2 {
        margin: 0 0 8px;
        font-size: 1.05rem;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .badge {
        font-size: 0.7rem;
        padding: 2px 8px;
        border-radius: 999px;
        background: rgba(96,165,250,0.16);
        color: var(--accent-blue);
        text-transform: uppercase;
        letter-spacing: 0.06em;
    }

    label {
        display: block;
        font-size: 0.8rem;
        margin-top: 8px;
        margin-bottom: 3px;
        color: var(--text-soft);
        text-transform: uppercase;
        letter-spacing: 0.06em;
    }

    select, input[type="number"], input[type="date"], textarea {
        width: 100%;
        padding: 8px 10px;
        font-size: 0.9rem;
        border-radius: var(--radius-md);
        border: 1px solid var(--border-subtle);
        background: var(--bg-card-soft);
        color: var(--text-main);
        outline: none;
        resize: vertical;
    }

    select:focus, input[type="number"]:focus, input[type="date"]:focus, textarea:focus {
        border-color: var(--accent-green);
        box-shadow: 0 0 0 1px rgba(42,255,128,0.4);
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    input[type="date"] {
        padding-right: 30px;
    }

    .row {
        display: flex;
        gap: 10px;
    }

    .row > div {
        flex: 1;
    }

    .btn-main {
        width: 100%;
        margin-top: 12px;
        padding: 10px;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: 600;
        background: var(--accent-green);
        color: #020309;
        box-shadow: 0 10px 20px rgba(42,255,128,0.35);
        transition: transform 0.05s ease, box-shadow 0.05s ease;
    }

    .btn-main:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 24px rgba(42,255,128,0.45);
    }

    .btn-main:active {
        transform: translateY(0);
        box-shadow: 0 6px 14px rgba(42,255,128,0.3);
    }

    .btn-secondary {
        width: 100%;
        margin-top: 10px;
        padding: 9px;
        border-radius: 999px;
        border: 1px solid var(--border-strong);
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        background: #05070b;
        color: #e5e7eb;
    }

    .btn-secondary:hover {
        border-color: var(--accent-green);
    }

    .btn-ghost {
        border-radius: 999px;
        padding: 6px 12px;
        border: 1px dashed var(--border-subtle);
        background: transparent;
        color: #e5e7eb;
        font-size: 0.8rem;
        cursor: pointer;
    }

    .btn-ghost:hover {
        border-style: solid;
        border-color: var(--accent-blue);
    }

    .sets-table {
        margin-top: 6px;
        width: 100%;
        border-collapse: collapse;
        font-size: 0.85rem;
    }

    .sets-table thead {
        background: rgba(15,23,42,0.9);
    }

    .sets-table th,
    .sets-table td {
        padding: 6px 6px;
        border-bottom: 1px solid rgba(31,41,55,0.9);
        text-align: left;
    }

    .sets-table th {
        font-weight: 600;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        color: var(--text-soft);
    }

    .sets-table tr:last-child td {
        border-bottom: none;
    }

    .pill {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        border: 1px solid var(--border-subtle);
    }

    .pill.work {
        border-color: rgba(250,250,250,0.8);
        color: var(--accent-green);
    }

    .pill.warm {
        border-color: rgba(96,165,250,0.7);
        color: var(--accent-blue);
    }

    .empty-note {
        font-size: 0.8rem;
        color: var(--text-muted);
        margin-top: 10px;
    }

    .template-hint {
        margin-top: 4px;
        font-size: 0.75rem;
        color: var(--text-soft);
    }

    .template-hint span {
        color: var(--accent-green);
        font-weight: 600;
    }

    .subsection-title {
        margin-top: 12px;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-soft);
    }

    /* Exercise cards */
    .exercise-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 6px;
    }

    .exercise-card {
        background: var(--bg-card-soft);
        border-radius: var(--radius-md);
        border: 1px solid rgba(55,65,81,0.9);
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        cursor: grab;
    }

    .exercise-card.dragging {
        opacity: 0.65;
        box-shadow: 0 8px 18px rgba(0,0,0,0.7);
    }

    .exercise-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 11px;
        background: linear-gradient(90deg, rgba(42,255,128,0.12), rgba(15,23,42,0.95));
    }

    .exercise-header-left {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .exercise-toggle {
        border: none;
        background: #05070b;
        color: #e5e7eb;
        border-radius: 999px;
        width: 22px;
        height: 22px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        cursor: pointer;
    }

    .exercise-name-block {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .exercise-name {
        font-size: 0.9rem;
        font-weight: 600;
    }

    .exercise-last {
        font-size: 0.7rem;
        color: var(--text-soft);
    }

    .exercise-body {
        padding: 8px 10px 10px;
        border-top: 1px solid rgba(31,41,55,0.9);
    }

    .exercise-body.collapsed {
        display: none;
    }

    .sets-container {
        display: flex;
        flex-direction: column;
        gap: 4px;
        margin-bottom: 6px;
    }

    .set-row {
        display: grid;
        grid-template-columns: auto minmax(0,1fr) minmax(0,1fr) auto;
        gap: 6px;
        align-items: center;
    }

    .set-label {
        font-size: 0.75rem;
        color: var(--text-soft);
    }

    .set-row input {
        width: 100%;
    }

    .remove-set-btn {
        border: none;
        background: transparent;
        color: var(--accent-red);
        cursor: pointer;
        font-size: 1rem;
        padding: 0 4px;
    }

    .notes-label {
        margin-top: 6px;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-muted);
    }

    .exercise-notes {
        margin-top: 3px;
        min-height: 40px;
    }

    .day-save-row {
        margin-top: 12px;
        display: flex;
        justify-content: flex-end;
    }

    /* Add exercise inline input */
    .add-exercise-inline {
        display: flex;
        gap: 6px;
        margin-top: 8px;
        align-items: center;
    }

    .add-exercise-inline input {
        flex: 1;
        padding: 8px 10px;
        font-size: 0.9rem;
        border-radius: var(--radius-md);
        border: 1px solid var(--border-subtle);
        background: var(--bg-card-soft);
        color: var(--text-main);
    }

    .add-exercise-inline input::placeholder {
        color: var(--text-soft);
    }

    .add-exercise-inline input:focus {
        border-color: var(--accent-green);
        box-shadow: 0 0 0 1px rgba(42,255,128,0.4);
        outline: none;
    }

    /* Timer footer */
    .timer-footer {
        position: sticky;
        bottom: 0;
        left: 0;
        margin-top: 18px;
        padding: 6px 10px;
        background: rgba(0,0,0,0.95);
        border-radius: 12px;
        border: 1px solid rgba(148,163,184,0.7);
        display: flex;
        flex-direction: column;
        gap: 6px;
        cursor: pointer;
        transition: all 0.15s ease-out;
    }

    .timer-footer.collapsed .timer-expanded {
        display: none;
    }

    .timer-summary {
        display: flex;
        justify-content: space-between;
        width: 100%;
        gap: 10px;
        align-items: center;
    }

    .timer-summary-main {
        display: flex;
        gap: 14px;
        font-size: 0.9rem;
    }

    .timer-summary-main span.label {
        color: var(--text-muted);
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        margin-right: 4px;
    }

    .timer-summary-main span.value {
        font-weight: 600;
        color: var(--accent-green);
    }

    .timer-chevron {
        font-size: 0.9rem;
        color: var(--text-soft);
    }

    .timer-expanded {
        display: flex;
        gap: 16px;
        width: 100%;
        margin-top: 4px;
    }

    .timer-block {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .timer-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-soft);
    }

    .timer-display {
        font-size: 1.2rem;
        font-weight: 600;
    }

    .timer-controls {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
    }

    .timer-btn {
        border-radius: 999px;
        padding: 4px 10px;
        border: 1px solid var(--border-subtle);
        background: #020309;
        color: #e5e7eb;
        font-size: 0.75rem;
        cursor: pointer;
    }

    .timer-btn.primary {
        border-color: var(--accent-green);
        color: var(--accent-green);
    }

    .timer-btn:hover {
        border-color: var(--accent-blue);
    }

    .rest-presets {
        display: flex;
        gap: 4px;
        flex-wrap: wrap;
        margin-top: 2px;
    }

    .rest-presets .timer-btn {
        padding: 3px 8px;
    }

    @media (max-width: 700px) {
        .timer-expanded {
            flex-direction: column;
        }
        .timer-footer {
            padding: 6px 8px 8px;
        }
    }

    /* Flash on rest done */
    .flash-effect {
        box-shadow: 0 0 0 1px rgba(255,255,255,0.6), 0 0 40px rgba(42,255,128,0.9);
        transition: box-shadow 0.2s ease-out;
    }
</style>
</head>
<body>

<div class="app">
    <header>
        <div class="header-left">
            <h1>
                Olympus Method
                <span class="logo-pill">Heavy Duty</span>
            </h1>
            <div class="tagline">
                High-intensity warm-ups, timers, and a full 3-day Push / Legs / Pull log — tuned for real gym use.
            </div>
        </div>
        <div class="header-right">
            <div class="unit-label">Unit</div>
            <div class="unit-toggle">
                <button type="button" id="kgBtn">kg</button>
                <button type="button" id="lbBtn">lb</button>
            </div>
        </div>
    </header>

    <!-- Tabs -->
    <div class="tabs">
        <button class="tab-button active" data-target="tab-calculator">
            <span class="dot"></span> Calculator
        </button>
        <button class="tab-button" data-target="tab-push">
            <span class="dot"></span> Day 1 — Push
        </button>
        <button class="tab-button" data-target="tab-legs">
            <span class="dot"></span> Day 2 — Legs
        </button>
        <button class="tab-button" data-target="tab-pull">
            <span class="dot"></span> Day 3 — Pull
        </button>
    </div>

    <!-- TAB 1: CALCULATOR -->
    <section id="tab-calculator" class="tab-panel active">
        <div class="grid">
            <!-- LEFT: Inputs -->
            <div class="card">
                <h2>
                    Lift Setup
                    <span class="badge">Warm-Ups</span>
                </h2>

                <label for="liftSelect">Lift</label>
                <select id="liftSelect">
                    <!-- Core big lifts -->
                    <option value="bench">Bench Press</option>
                    <option value="incline_bench">Incline Barbell Bench Press</option>
                    <option value="flat_bench">Flat Barbell Bench Press</option>
                    <option value="squat">Barbell Back Squat</option>
                    <option value="deadlift">Deadlift</option>
                    <option value="rdl">Romanian Deadlift</option>
                    <option value="ohp">Overhead Press</option>
                    <option value="row">Bent-Over Barbell Row</option>
                    <option value="pullups">Weighted Pull-Ups</option>
                    <!-- Other split exercises -->
                    <option value="weighted_dips">Weighted Dips (Chest-focused)</option>
                    <option value="lat_raise">Dumbbell Lateral Raises</option>
                    <option value="triceps_pushdown">Rope Triceps Pushdown</option>
                    <option value="skull_crushers">Skull Crushers</option>
                    <option value="ham_curl">Hamstring Curl (Machine)</option>
                    <option value="calf_raises">Calf Raises</option>
                    <option value="leg_press">Leg Press (Optional)</option>
                    <option value="hack_squat">Hack Squat (Optional)</option>
                    <option value="biceps_curl">Barbell Biceps Curl</option>
                    <option value="rear_delt">Rear Delt Flys</option>
                    <option value="shrugs">Barbell Shrugs</option>
                    <!-- Custom -->
                    <option value="custom">Custom / Other</option>
                </select>

                <div class="row">
                    <div>
                        <label for="workingWeight">Working Set Weight</label>
                        <input type="number" id="workingWeight" placeholder="e.g. 100" step="0.5" min="0" inputmode="decimal" />
                    </div>
                    <div>
                        <label for="barWeight">Bar Weight</label>
                        <input type="number" id="barWeight" placeholder="20 for kg / 45 for lb" step="0.5" min="0" inputmode="decimal" />
                    </div>
                </div>

                <div class="row">
                    <div>
                        <label for="templateSelect">Warm-Up Template</label>
                        <select id="templateSelect">
                            <option value="soviet">Soviet Strength</option>
                            <option value="mentzer">Mike Mentzer</option>
                            <option value="olympus">Olympus Method</option>
                        </select>
                    </div>
                </div>

                <div class="template-hint" id="templateHint"></div>

                <button class="btn-main" id="calcBtn">Calculate Warm-Ups & Plates</button>
            </div>

            <!-- RIGHT: Results -->
            <div class="card">
                <h2>
                    Warm-Ups & Plates
                    <span class="badge">Output</span>
                </h2>

                <table class="sets-table" id="resultsTable" style="display:none;">
                    <thead>
                        <tr>
                            <th>Set</th>
                            <th>Type</th>
                            <th>%</th>
                            <th>Reps</th>
                            <th>Target</th>
                            <th>Plates / side</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody"></tbody>
                </table>

                <div class="empty-note" id="emptyNote">
                    Enter working weight & bar, choose your template, then tap <strong>Calculate</strong>.
                </div>
            </div>
        </div>
    </section>

    <!-- TAB 2: PUSH -->
    <section id="tab-push" class="tab-panel">
        <div class="card">
            <h2>
                Day 1 — Push
                <span class="badge">Chest / Shoulders / Triceps</span>
            </h2>

            <label class="subsection-title" style="margin-top:10px;">Workout Date</label>
            <input type="date" class="workout-date" data-day="push" />

            <p class="subsection-title" style="margin-top:10px;">Exercises</p>
            <div class="exercise-list" id="pushExercises"></div>

            <div class="add-exercise-inline">
                <input type="text" id="pushAddInput" placeholder="Add exercise..." />
                <button type="button" class="btn-ghost" data-day="push" id="pushAddBtn">+ Add</button>
            </div>

            <div class="day-save-row">
                <button type="button" class="btn-secondary save-day-btn" data-day="push">Save Day 1 Log</button>
            </div>
        </div>
    </section>

    <!-- TAB 3: LEGS -->
    <section id="tab-legs" class="tab-panel">
        <div class="card">
            <h2>
                Day 2 — Legs
                <span class="badge">Quads / Hams / Calves</span>
            </h2>

            <label class="subsection-title" style="margin-top:10px;">Workout Date</label>
            <input type="date" class="workout-date" data-day="legs" />

            <p class="subsection-title" style="margin-top:10px;">Exercises</p>
            <div class="exercise-list" id="legsExercises"></div>

            <div class="add-exercise-inline">
                <input type="text" id="legsAddInput" placeholder="Add exercise..." />
                <button type="button" class="btn-ghost" data-day="legs" id="legsAddBtn">+ Add</button>
            </div>

            <div class="day-save-row">
                <button type="button" class="btn-secondary save-day-btn" data-day="legs">Save Day 2 Log</button>
            </div>
        </div>
    </section>

    <!-- TAB 4: PULL -->
    <section id="tab-pull" class="tab-panel">
        <div class="card">
            <h2>
                Day 3 — Pull
                <span class="badge">Back / Rear Delts / Biceps</span>
            </h2>

            <label class="subsection-title" style="margin-top:10px;">Workout Date</label>
            <input type="date" class="workout-date" data-day="pull" />

            <p class="subsection-title" style="margin-top:10px;">Exercises</p>
            <div class="exercise-list" id="pullExercises"></div>

            <div class="add-exercise-inline">
                <input type="text" id="pullAddInput" placeholder="Add exercise..." />
                <button type="button" class="btn-ghost" data-day="pull" id="pullAddBtn">+ Add</button>
            </div>

            <div class="day-save-row">
                <button type="button" class="btn-secondary save-day-btn" data-day="pull">Save Day 3 Log</button>
            </div>
        </div>
    </section>

    <!-- TIMER FOOTER -->
    <div class="timer-footer collapsed" id="timerFooter">
        <div class="timer-summary">
            <div class="timer-summary-main">
                <div><span class="label">Workout</span> <span class="value" id="workoutSummary">00:00</span></div>
                <div><span class="label">Rest</span> <span class="value" id="restSummary">00s</span></div>
            </div>
            <div class="timer-chevron" id="timerChevron">▲</div>
        </div>
        <div class="timer-expanded">
            <div class="timer-block">
                <div class="timer-label">Workout Timer</div>
                <div class="timer-display" id="workoutDisplay">00:00</div>
                <div class="timer-controls">
                    <button class="timer-btn primary" id="workoutStartPause">Start</button>
                    <button class="timer-btn" id="workoutReset">Reset</button>
                </div>
            </div>

            <div class="timer-block">
                <div class="timer-label">Rest Timer</div>
                <div class="timer-display" id="restDisplay">00s</div>
                <div class="rest-presets">
                    <button class="timer-btn rest-preset" data-sec="60">1 min</button>
                    <button class="timer-btn rest-preset" data-sec="120">2 min</button>
                    <button class="timer-btn rest-preset" data-sec="300">5 min</button>
                </div>
                <div class="timer-controls">
                    <button class="timer-btn primary" id="restStartPause">Start</button>
                    <button class="timer-btn" id="restReset">Reset</button>
                    <button class="timer-btn" id="restPlus30">+30s</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // ---- Tabs ----
    const tabButtons = document.querySelectorAll(".tab-button");
    const tabPanels = document.querySelectorAll(".tab-panel");

    tabButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            const target = btn.getAttribute("data-target");

            tabButtons.forEach(b => b.classList.remove("active"));
            tabPanels.forEach(p => p.classList.remove("active"));

            btn.classList.add("active");
            document.getElementById(target).classList.add("active");
        });
    });

    // ---- Global unit toggle ----
    let currentUnit = "kg";
    const kgBtn = document.getElementById("kgBtn");
    const lbBtn = document.getElementById("lbBtn");

    function setUnit(unit) {
        currentUnit = unit;
        if (unit === "kg") {
            kgBtn.classList.add("active");
            lbBtn.classList.remove("active");
            if (!barWeightInput.value) barWeightInput.value = 20;
        } else {
            lbBtn.classList.add("active");
            kgBtn.classList.remove("active");
            if (!barWeightInput.value) barWeightInput.value = 45;
        }
    }

    kgBtn.addEventListener("click", () => setUnit("kg"));
    lbBtn.addEventListener("click", () => setUnit("lb"));

    // ---- Warm-up logic / calculator ----
    const TEMPLATES = {
        soviet: {
            name: "Soviet Strength",
            description: "40% x 5, 70% x 2–3, then 100% working set.",
            sets: [
                { type: "Warm-up", percent: 0.40, reps: "5" },
                { type: "Warm-up", percent: 0.70, reps: "2–3" },
                { type: "Working", percent: 1.00, reps: "6–10 (to failure)" }
            ]
        },
        mentzer: {
            name: "Mike Mentzer",
            description: "50% x 6–8, 75% x 3–4, 100% x 6–10 to failure.",
            sets: [
                { type: "Warm-up", percent: 0.50, reps: "6–8" },
                { type: "Warm-up", percent: 0.75, reps: "3–4" },
                { type: "Working", percent: 1.00, reps: "6–10 (to failure)" }
            ]
        },
        olympus: {
            name: "Olympus Method",
            description: "30% x 5, 50% x 3–5, then 100% x 6–10 to failure.",
            sets: [
                { type: "Warm-up", percent: 0.30, reps: "5" },
                { type: "Warm-up", percent: 0.50, reps: "3–5" },
                { type: "Working", percent: 1.00, reps: "6–10 (to failure)" }
            ]
        }
    };

    const KG_PLATES = [25, 20, 15, 10, 5, 2.5, 1.25];
    const LB_PLATES = [45, 35, 25, 10, 5, 2.5];

    const workingWeightInput = document.getElementById("workingWeight");
    const barWeightInput = document.getElementById("barWeight");
    const templateSelect = document.getElementById("templateSelect");
    const templateHint = document.getElementById("templateHint");
    const resultsTable = document.getElementById("resultsTable");
    const resultsBody = document.getElementById("resultsBody");
    const emptyNote = document.getElementById("emptyNote");
    const calcBtn = document.getElementById("calcBtn");

    function updateTemplateHint() {
        const tKey = templateSelect.value;
        const t = TEMPLATES[tKey];
        if (!t) {
            templateHint.textContent = "";
            return;
        }
        templateHint.innerHTML = `<span>${t.name}:</span> ${t.description}`;
    }

    templateSelect.addEventListener("change", updateTemplateHint);
    updateTemplateHint();

    function formatWeight(value) {
        if (!isFinite(value)) return "-";
        return value.toFixed(1).replace(/\.0$/, "");
    }

    function plateConfig() {
        return currentUnit === "kg" ? KG_PLATES : LB_PLATES;
    }

    function computePlates(targetWeight, barWeight) {
        const plateSizes = plateConfig();
        const epsilon = 1e-6;

        if (targetWeight < barWeight - epsilon) {
            return { text: "Bar only", raw: [] };
        }

        let remainingTotal = targetWeight - barWeight;
        if (remainingTotal < 0) remainingTotal = 0;

        let perSide = remainingTotal / 2;
        const platesPerSide = [];

        for (const p of plateSizes) {
            let count = Math.floor((perSide + epsilon) / p);
            if (count > 0) {
                platesPerSide.push({ size: p, count });
                perSide -= count * p;
            }
        }

        if (platesPerSide.length === 0) {
            return { text: "Bar only", raw: [] };
        }

        const text = platesPerSide
            .map(pl => `${formatWeight(pl.size)} × ${pl.count}`)
            .join(", ");

        return { text: text + " / side", raw: platesPerSide };
    }

    function calculateWarmups() {
        const work = parseFloat(workingWeightInput.value);
        const bar = parseFloat(barWeightInput.value);

        if (!isFinite(work) || work <= 0) {
            alert("Enter a valid working set weight.");
            return;
        }
        if (!isFinite(bar) || bar <= 0) {
            alert("Enter a valid bar weight.");
            return;
        }

        const tpl = TEMPLATES[templateSelect.value];
        resultsBody.innerHTML = "";

        tpl.sets.forEach((set, idx) => {
            const target = work * set.percent;
            const plates = computePlates(target, bar);

            const tr = document.createElement("tr");

            tr.innerHTML = `
                <td>${idx + 1}</td>
                <td><span class="pill ${set.type === "Working" ? "work" : "warm"}">${set.type}</span></td>
                <td>${Math.round(set.percent * 100)}%</td>
                <td>${set.reps}</td>
                <td>${formatWeight(target)} ${currentUnit}</td>
                <td>${plates.text}</td>
            `;

            resultsBody.appendChild(tr);
        });

        resultsTable.style.display = "table";
        emptyNote.style.display = "none";
    }

    calcBtn.addEventListener("click", calculateWarmups);

    // ---- Day logs ----
    const DAY_LOG_KEY = "olympusDayLogs_v1";

    function loadDayLogs() {
        try {
            const raw = localStorage.getItem(DAY_LOG_KEY);
            return raw ? JSON.parse(raw) : [];
        } catch {
            return [];
        }
    }

    function saveDayLogs(logs) {
        localStorage.setItem(DAY_LOG_KEY, JSON.stringify(logs));
    }

    function getLastDayDate(dayKey) {
        const logs = loadDayLogs();
        for (let i = logs.length - 1; i >= 0; i--) {
            if (logs[i].day === dayKey && logs[i].date) {
                return logs[i].date;
            }
        }
        return null;
    }

    function getLastExerciseLog(dayKey, exName) {
        const logs = loadDayLogs();
        for (let i = logs.length - 1; i >= 0; i--) {
            const log = logs[i];
            if (log.day !== dayKey || !Array.isArray(log.exercises)) continue;
            const ex = log.exercises.find(e => e.name === exName);
            if (ex && ex.sets && ex.sets.length > 0) {
                return ex;
            }
        }
        return null;
    }

    const DAY_CONTAINERS = {
        push: document.getElementById("pushExercises"),
        legs: document.getElementById("legsExercises"),
        pull: document.getElementById("pullExercises")
    };

    const DEFAULT_SPLIT = {
        push: [
            "Incline Barbell Bench Press",
            "Flat Barbell Bench Press",
            "Weighted Dips (Chest-focused)",
            "Dumbbell Lateral Raises",
            "Rope Pushdown / Skull Crushers"
        ],
        legs: [
            "Barbell Back Squat",
            "Romanian Deadlift",
            "Hamstring Curl (Machine)",
            "Calf Raises",
            "Leg Press (Optional)",
            "Hack Squat (Optional)"
        ],
        pull: [
            "Weighted Pull-Ups",
            "Bent-Over Barbell Row",
            "Barbell Biceps Curl",
            "Rear Delt Flys",
            "Barbell Shrugs"
        ]
    };

    function escapeHtml(str) {
        return str.replace(/[&<>"']/g, function (c) {
            return ({
                "&": "&amp;",
                "<": "&lt;",
                ">": "&gt;",
                '"': "&quot;",
                "'": "&#39;"
            })[c];
        });
    }

    // Add set row; returns the row element
    function addSetRow(card, autoFocusWeight = true) {
        const container = card.querySelector(".sets-container");
        const index = container.children.length + 1;
        const row = document.createElement("div");
        row.className = "set-row";
        row.innerHTML = `
            <span class="set-label">Set ${index}</span>
            <input type="number" class="set-weight" placeholder="Weight" step="0.5" inputmode="decimal" />
            <input type="number" class="set-reps" placeholder="Reps" step="1" inputmode="numeric" />
            <button type="button" class="remove-set-btn">×</button>
        `;
        container.appendChild(row);

        const weightInput = row.querySelector(".set-weight");
        const repsInput = row.querySelector(".set-reps");
        const removeBtn = row.querySelector(".remove-set-btn");
        const dayKey = card.dataset.dayKey;

        if (autoFocusWeight) {
            weightInput.focus();
        }

        weightInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                e.preventDefault();
                repsInput.focus();
            }
        });

        removeBtn.addEventListener("click", () => {
            row.remove();
            Array.from(container.children).forEach((r, i) => {
                const label = r.querySelector(".set-label");
                if (label) label.textContent = `Set ${i + 1}`;
            });
            autoSaveDayLog(dayKey);
        });

        weightInput.addEventListener("input", () => autoSaveDayLog(dayKey));
        repsInput.addEventListener("input", () => autoSaveDayLog(dayKey));

        return row;
    }

    function createExerciseCard(dayKey, name) {
        const container = DAY_CONTAINERS[dayKey];
        if (!container) return;

        const card = document.createElement("div");
        card.className = "exercise-card";
        card.setAttribute("draggable", "true");
        card.dataset.dayKey = dayKey;

        const lastLog = getLastExerciseLog(dayKey, name);

        let lastSummary = "";
        if (lastLog && lastLog.sets && lastLog.sets.length > 0) {
            const s = lastLog.sets[lastLog.sets.length - 1];
            lastSummary = `Last: ${formatWeight(s.weight)} ${currentUnit} × ${s.reps}`;
        }

        card.innerHTML = `
            <div class="exercise-header">
                <div class="exercise-header-left">
                    <button type="button" class="exercise-toggle">▼</button>
                    <div class="exercise-name-block">
                        <span class="exercise-name">${escapeHtml(name)}</span>
                        <span class="exercise-last">${lastSummary}</span>
                    </div>
                </div>
            </div>
            <div class="exercise-body">
                <div class="sets-container"></div>
                <label class="notes-label">Notes</label>
                <textarea class="exercise-notes" rows="2" placeholder="Notes, RPE, technique..."></textarea>
            </div>
        `;

        const body = card.querySelector(".exercise-body");
        const toggleBtn = card.querySelector(".exercise-toggle");

        // Expanded by default
        body.classList.remove("collapsed");
        toggleBtn.textContent = "▼";

        toggleBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            const collapsed = body.classList.toggle("collapsed");
            toggleBtn.textContent = collapsed ? "▶" : "▼";
        });

        const header = card.querySelector(".exercise-header");
        header.addEventListener("click", (e) => {
            if (e.target === toggleBtn) return;
            const collapsed = body.classList.toggle("collapsed");
            toggleBtn.textContent = collapsed ? "▶" : "▼";
        });

        // Prefill sets from last workout (Option A)
        if (lastLog && lastLog.sets && lastLog.sets.length > 0) {
            lastLog.sets.forEach(set => {
                const row = addSetRow(card, false);
                row.querySelector(".set-weight").value = set.weight;
                row.querySelector(".set-reps").value = set.reps;
            });
        } else {
            // Default to 2 blank sets
            addSetRow(card, false);
            addSetRow(card, false);
        }

        // Notes auto-save
        const notes = card.querySelector(".exercise-notes");
        notes.addEventListener("input", () => autoSaveDayLog(dayKey));

        // Drag & drop
        card.addEventListener("dragstart", (e) => {
            card.classList.add("dragging");
            e.dataTransfer.effectAllowed = "move";
        });
        card.addEventListener("dragend", () => {
            card.classList.remove("dragging");
            autoSaveDayLog(dayKey);
        });

        container.appendChild(card);
    }

    function initDefaultExercises() {
        ["push", "legs", "pull"].forEach(dayKey => {
            DEFAULT_SPLIT[dayKey].forEach(name => createExerciseCard(dayKey, name));
        });
    }

    initDefaultExercises();

    // Drag & drop handling
    Object.keys(DAY_CONTAINERS).forEach(dayKey => {
        const list = DAY_CONTAINERS[dayKey];

        list.addEventListener("dragover", (e) => {
            e.preventDefault();
            const dragging = list.querySelector(".exercise-card.dragging");
            const after = getDragAfterElement(list, e.clientY);
            if (!dragging) return;
            if (after == null) {
                list.appendChild(dragging);
            } else {
                list.insertBefore(dragging, after);
            }
        });
    });

    function getDragAfterElement(container, y) {
        const cards = [...container.querySelectorAll(".exercise-card:not(.dragging)")];
        let closest = null;
        let closestOffset = Number.NEGATIVE_INFINITY;
        cards.forEach(card => {
            const rect = card.getBoundingClientRect();
            const offset = y - rect.top - rect.height / 2;
            if (offset < 0 && offset > closestOffset) {
                closestOffset = offset;
                closest = card;
            }
        });
        return closest;
    }

    // Add exercise inline
    function setupAddExercise(dayKey, inputId, btnId) {
        const input = document.getElementById(inputId);
        const btn = document.getElementById(btnId);

        function add() {
            const name = input.value.trim();
            if (!name) return;
            createExerciseCard(dayKey, name);
            input.value = "";
            autoSaveDayLog(dayKey);
        }

        btn.addEventListener("click", add);

        input.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                e.preventDefault();
                add();
            }
        });
    }

    setupAddExercise("push", "pushAddInput", "pushAddBtn");
    setupAddExercise("legs", "legsAddInput", "legsAddBtn");
    setupAddExercise("pull", "pullAddInput", "pullAddBtn");

    // Workout dates init
    document.querySelectorAll(".workout-date").forEach(input => {
        const day = input.dataset.day;
        const last = getLastDayDate(day);
        if (last) {
            input.value = last.slice(0, 10);
        } else {
            input.value = new Date().toISOString().slice(0, 10);
        }

        input.addEventListener("change", () => {
            autoSaveDayLog(day);
        });
    });

    // Save day log (manual & auto)
    document.querySelectorAll(".save-day-btn").forEach(btn => {
        btn.addEventListener("click", () => {
            const day = btn.getAttribute("data-day");
            saveDayLog(day, false);
        });
    });

    function gatherDayLog(dayKey) {
        const container = DAY_CONTAINERS[dayKey];
        if (!container) return null;

        const dateInput = document.querySelector(`.workout-date[data-day="${dayKey}"]`);
        let dateIso;
        if (dateInput && dateInput.value) {
            dateIso = new Date(dateInput.value + "T00:00:00").toISOString();
        } else {
            dateIso = new Date().toISOString();
        }

        const cards = container.querySelectorAll(".exercise-card");
        const log = {
            day: dayKey,
            date: dateIso,
            exercises: []
        };

        cards.forEach(card => {
            const name = card.querySelector(".exercise-name").textContent.trim();
            const notes = card.querySelector(".exercise-notes").value.trim();
            const sets = [];

            card.querySelectorAll(".set-row").forEach(row => {
                const w = parseFloat(row.querySelector(".set-weight").value);
                const r = parseInt(row.querySelector(".set-reps").value, 10);
                if (isFinite(w) && w > 0 && Number.isFinite(r) && r > 0) {
                    sets.push({ weight: w, reps: r });
                }
            });

            if (name || sets.length || notes) {
                log.exercises.push({ name, notes, sets });
            }
        });

        return log;
    }

    function saveDayLog(dayKey, silent = true) {
        const log = gatherDayLog(dayKey);
        if (!log) return;

        const logs = loadDayLogs();
        logs.push(log);
        saveDayLogs(logs);

        if (!silent) {
            const label = dayKey === "push" ? "Day 1" : dayKey === "legs" ? "Day 2" : "Day 3";
            alert(label + " log saved!");
        }
    }

    // Auto-save debounced
    const autoSaveTimers = {};
    function autoSaveDayLog(dayKey) {
        if (autoSaveTimers[dayKey]) clearTimeout(autoSaveTimers[dayKey]);
        autoSaveTimers[dayKey] = setTimeout(() => {
            saveDayLog(dayKey, true);
        }, 800);
    }

    // ---- Timers ----
    const workoutDisplay = document.getElementById("workoutDisplay");
    const workoutSummary = document.getElementById("workoutSummary");
    const restDisplay = document.getElementById("restDisplay");
    const restSummary = document.getElementById("restSummary");
    const workoutStartPauseBtn = document.getElementById("workoutStartPause");
    const workoutResetBtn = document.getElementById("workoutReset");
    const restStartPauseBtn = document.getElementById("restStartPause");
    const restResetBtn = document.getElementById("restReset");
    const restPresetBtns = document.querySelectorAll(".rest-preset");
    const restPlus30Btn = document.getElementById("restPlus30");
    const timerFooter = document.getElementById("timerFooter");
    const timerChevron = document.getElementById("timerChevron");

    let workoutSeconds = 0;
    let workoutInterval = null;
    let workoutRunning = false;

    function formatTime(sec) {
        const m = Math.floor(sec / 60);
        const s = sec % 60;
        return String(m).padStart(2, "0") + ":" + String(s).padStart(2, "0");
    }

    function updateWorkoutDisplay() {
        const text = formatTime(workoutSeconds);
        workoutDisplay.textContent = text;
        workoutSummary.textContent = text;
    }

    workoutStartPauseBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        if (!workoutRunning) {
            workoutRunning = true;
            workoutStartPauseBtn.textContent = "Pause";
            workoutInterval = setInterval(() => {
                workoutSeconds += 1;
                updateWorkoutDisplay();
            }, 1000);
        } else {
            workoutRunning = false;
            workoutStartPauseBtn.textContent = "Start";
            clearInterval(workoutInterval);
        }
    });

    workoutResetBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        workoutRunning = false;
        clearInterval(workoutInterval);
        workoutSeconds = 0;
        updateWorkoutDisplay();
        workoutStartPauseBtn.textContent = "Start";
    });

    updateWorkoutDisplay();

    // Rest timer
    let restDuration = 60;
    let restRemaining = 60;
    let restInterval = null;
    let restRunning = false;

    function updateRestDisplay() {
        restDisplay.textContent = String(restRemaining) + "s";
        restSummary.textContent = String(restRemaining) + "s";
    }

    restPresetBtns.forEach(btn => {
        btn.addEventListener("click", (e) => {
            e.stopPropagation();
            const sec = parseInt(btn.getAttribute("data-sec"), 10);
            if (!Number.isFinite(sec)) return;
            restDuration = sec;
            restRemaining = sec;
            updateRestDisplay();
        });
    });

    restPlus30Btn.addEventListener("click", (e) => {
        e.stopPropagation();
        restRemaining += 30;
        restDuration = restRemaining;
        updateRestDisplay();
    });

    function playBeep() {
        try {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const o = ctx.createOscillator();
            const g = ctx.createGain();
            o.type = "sine";
            o.frequency.value = 880;
            o.connect(g);
            g.connect(ctx.destination);
            g.gain.setValueAtTime(0.2, ctx.currentTime);
            o.start();
            g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.3);
            o.stop(ctx.currentTime + 0.3);
        } catch (e) {
            // ignore
        }
    }

    function vibratePattern() {
        if (navigator.vibrate) {
            navigator.vibrate([200, 100, 200]);
        }
    }

    function flashEffect() {
        timerFooter.classList.add("flash-effect");
        setTimeout(() => timerFooter.classList.remove("flash-effect"), 500);
    }

    restStartPauseBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        if (!restRunning) {
            if (restRemaining <= 0) restRemaining = restDuration;
            restRunning = true;
            restStartPauseBtn.textContent = "Pause";
            restInterval = setInterval(() => {
                restRemaining -= 1;
                if (restRemaining <= 0) {
                    restRemaining = 0;
                    clearInterval(restInterval);
                    restRunning = false;
                    restStartPauseBtn.textContent = "Start";
                    updateRestDisplay();
                    playBeep();
                    vibratePattern();
                    flashEffect();
                    alert("Rest over — time to hit the next set.");
                    return;
                }
                updateRestDisplay();
            }, 1000);
        } else {
            restRunning = false;
            restStartPauseBtn.textContent = "Start";
            clearInterval(restInterval);
        }
    });

    restResetBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        restRunning = false;
        clearInterval(restInterval);
        restRemaining = restDuration;
        updateRestDisplay();
        restStartPauseBtn.textContent = "Start";
    });

    updateRestDisplay();

    // Footer expand/collapse
    timerFooter.addEventListener("click", () => {
        const collapsed = timerFooter.classList.toggle("collapsed");
        timerChevron.textContent = collapsed ? "▲" : "▼";
    });

    // Prevent inner button clicks from toggling collapse
    document.querySelectorAll(".timer-footer .timer-btn").forEach(btn => {
        btn.addEventListener("click", (e) => e.stopPropagation());
    });

    // Defaults
    setUnit("kg");
    barWeightInput.value = 20;
</script>

</body>
</html>
